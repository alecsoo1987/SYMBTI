<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/main.css">
</head>

<body>
    <%- include('modal/registerError') %>
    <div id="wrap">
        <div id="header" role="header">
            <header>
                <%- include('nav.ejs') %>
            </header>
        </div>
        <div id="container">
            <div class="main-content-wrap addQuestion">
                <div class="contentsType mb-4">회원가입</div>
                <form action="/register" method="POST" class="register-form">
                    <input type="hidden" name="id">
                    <div class="form-group">
                        <div class="text-field">
                            <label for="username">아이디
                                <span class="fc-red fs-14">
                                    (*)
                                </span>
                                <span class="help-message">
                                    6~12자, 특수문자를 제외한 영문 소문자 + 숫자로만 가입 가능합니다.
                                </span>
                            </label>
                            <input type="text" class="form-control" id="username" name="username" minlength="6"
                                maxlength="12">
                            <label for="password">비밀번호
                                <span class="fc-red fs-14">
                                    (*)
                                </span>
                                <span class="help-message">
                                    6~12자까지 입력 가능합니다.
                                </span>
                            </label>
                            <input type="password" class="form-control" id="password" name="password" minlength="6"
                                maxlength="12">
                            <label for="confirmPassword">비밀번호 확인
                                <span class="fc-red fs-14">
                                    (*)
                                </span>
                            </label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword"
                                minlength="6" maxlength="12">
                        </div>
                        <div class="selection-select">
                            <label for="selectMBTI">MBTI를 선택하세요
                                <span class="fc-red fs-14">
                                    (*)
                                </span>
                            </label>
                            <div class="select-box">
                                <select id="selectMBTI" name="selectMBTI">
                                    <option value="default">선택</option>
                                    <option value="ISTJ">ISTJ</option>
                                    <option value="ISTP">ISTP</option>
                                    <option value="ISFJ">ISFJ</option>
                                    <option value="ISFP">ISFP</option>
                                    <option value="INTJ">INTJ</option>
                                    <option value="INTP">INTP</option>
                                    <option value="INFJ">INFJ</option>
                                    <option value="INFP">INFP</option>
                                    <option value="ESTJ">ESTJ</option>
                                    <option value="ESTP">ESTP</option>
                                    <option value="ESFJ">ESFJ</option>
                                    <option value="ESFP">ESFP</option>
                                    <option value="ENTJ">ENTJ</option>
                                    <option value="ENTP">ENTP</option>
                                    <option value="ENFJ">ENFJ</option>
                                    <option value="ENFP">ENFP</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="footer">
                        <button type="submit" class="btn button-green">
                            가입하기
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div id="footer"></div>
    </div>
</body>

</html>
<script>
    document.getElementById('registerForm').addEventListener('submit', async (event) => {
        event.preventDefault();
        const formData = new FormData(event.target);
        console.log(formData)

        try {            
            const response = await fetch('/register', {
                method: 'POST',
                body: formData
            });

            // 서버 응답을 JSON으로 파싱합니다.
            const data = await response.json();

            // 서버 응답 상태가 OK가 아닌 경우 (즉, 에러가 발생한 경우)
            if (!response.ok) {
                // 에러 메시지를 모달에 표시합니다.
                showModal(data.message);
            } else {
                // 서버 응답이 성공적인 경우, 로그인 페이지로 리디렉션합니다.
                window.location.href = '/login';
            }
        } catch (error) {
            // 네트워크 오류 등 예외가 발생한 경우
            console.error('Error:', error);
            // 모달에 기본 에러 메시지를 표시합니다.
            showModal('서버 오류가 발생했습니다.');
        }
    });

    // 모달을 표시하는 함수입니다.
    function showModal(message) {
        // 모달 요소를 가져옵니다.
        const modal = document.getElementById('registerError');
        // 모달의 메시지 요소를 가져옵니다.
        const modalMessage = document.getElementById('modalMessage');
        // 모달의 닫기 버튼을 가져옵니다.
        const closeButton = document.querySelector('.close-button');

        // 모달 메시지에 전달된 메시지를 설정합니다.
        modalMessage.textContent = message;
        // 모달을 화면에 표시합니다.
        modal.style.display = 'block';

        // 닫기 버튼 클릭 시 모달을 닫습니다.
        closeButton.onclick = function () {
            modal.style.display = 'none';
        };

        // 모달 외부를 클릭 시 모달을 닫습니다.
        window.onclick = function (event) {
            // 클릭한 대상이 모달일 경우
            if (event.target === modal) {
                // 모달을 닫습니다.
                modal.style.display = 'none';
            }
        };
    }
</script>